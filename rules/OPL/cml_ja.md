<sub>[READMEへ](../../README.md)</sub>

[日本語](./cml_ja.md) | [English](./cml_en.md)

# Carry My Luggage（CML）

参考動画：https://youtu.be/dzyJ1dHTulc

> [!NOTE]  
> 参考動画は完璧ではない．RoboCupのルールによってタスク内容が異なる可能性があるので，あくまで参考程度にしてください．
> 気になる点や議論したい点などがありましたら，GitHubの[Issues](https://github.com/RoboCupAtHomeJP/Rule2023/issues)にてご記入ください．


## メインゴール（Main Goal）

このタスクでは，外に駐車された車（イメージ）までロボットがオペレータの荷物運搬を支援することを想定している．ロボットは荷物（紙バッグ）を掴んだ後，既知環境から未知環境までオペレータ追従し，荷物運搬の支援を行う．その後，自律的にスタート地点（既知環境）まで戻ることことを行う．

> [!NOTE]  
> Educationリーグと同じ競技を採用し，ルール内容も同じなのですが，差別化のため異なる採点方式を用いている．


## フォーカス（Focus）

このタスクは，指差し認識，マニピュレーション，既知環境と未知環境でのマッピングやナビゲーション，人追従走行，音声対話，タスクプランニングなどに焦点を当てている．


## セットアップ（Settings）

- **ロケーション**：家庭環境を模したアリーナ環境が用いられる．競技はアリーナの内外で行われる．`アリーナ内`は事前にマッピングすることができる（`既知環境`）が，`アリーナ外`は事前にマッピングすることは禁止とする（`未知環境`）．
- **スタートロケーション**： ロボットは，2つの椅子の中心に向かって，`Room 2: Dining Room`の中心からスタートする．
- **荷物（紙バッグ）**： オペレーターの近く（2\[m\]以内の距離でロボットから見える位置）に，2つの紙バッグを設置する．
  <!-- - [荷物(バッグ)](https://www.amazon.co.jp/gp/product/B07T52SRRN/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1)には，200×240×90[mm]のものを使用する．-->
  - **サイズ**：260×10×310\[mm\] [Amazonリンク](https://www.amazon.co.jp/dp/B0173OZPSW/?th=1)．
  - **配置場所**：自チームで行う．この際，荷物（紙バッグ）は椅子の上に設置していく（椅子はフォロミーの経路上に被らないように[Tidy Up for OPL](./tu_ja.md#物体カテゴリーごと配置場所object-category-and-placement-goal)タスクと同じ配置となる）．
- **オペレーター**： オペレーターは，ロボットの前に立って競技で使用する紙バッグを指さす．オペレーターは自チームから選出してください．

> **Warning**
> Educationリーグのルールに合わていく方針のため、ルールが変わる可能性がある．その際，全体で共有する．

## シナリオ（Scenario）

### スタートフェーズ（Starting Phase）

1. **競技時間**：競技時間は**7分間**となる．
1. **配置**：レフェリーは，チームにロボットをスタート位置へ移動させるよう指示する．
1. **スタート**：レフェリーはスタートの合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ（スタートボタンを押す等）を完了し，エリアを離れる．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められない．
1. **指差し**：オペレータはスタートの合図と同時に，2つの紙バッグの内，事前に指定されたバッグの方を指さす．
1. **把持**：ロボットは，オペレータが指さしたバッグを認識し，それを把持する．

### フォロミーフェーズ（Follow-Me Phase）

1. **運搬開始**：ロボットが紙バッグを把持し追従可能な状態になったら，ロボットはオペレーターにその主旨を伝える．
1. **歩行**：その後，オペレータは既知環境から未知環境に向かって歩き始める．このとき，アリーナの外にあるゴール地点は固定の場所とする．
1. **フォロミー**：ロボットは歩き始めたオペレータを追従し，走行する．オペレータがゴールにたどり着いた場合，オペレータからその主旨を伝えてもらう．

> **Warning**
> オペレーターが歩行し始めたら、ロボットの方に向いたり，歩行を止まったりすることは禁止とする．

### ナビゲーションフェーズ（Navigation Phase）

1. **受け渡し**：オペレータとロボットがゴールに着いた後，オペレーターはロボットからバッグを受け取り，ロボットにお礼をする．
1. **ナビゲーション**：ロボットは未知環境から既知環境にある`スタート地点`まで自律的に移動する．このとき，ロボットは様々な障害物を回避しながら自律走行を行う．ただし，この障害物に挑戦するかどうかは各チームで決めることができる（障害物を回避するごとに加点される）．
この障害物の種類には下記の4つのモノがある．
   - 人混み（3～4人）が静的な状態で邪魔をする
   - 地面にある小さな物体（積み木など）
   - 見づらい3Dオブジェクト（椅子やグラスなど）
   - 開閉式バリア（ガイドポールなど）
1. **ゴール**：ロボットが`スタート地点`へ戻ったら，タスク終了になる．


## デウス・エクス・マキナ（Deus ex Machina）

本タスクでは，次のデウス・エクス・マキナが採用される．デウス・エクス・マキナでは該当アクションの点数は入らないが，より簡単な手法で部分的なタスクをスキップし，全体的なタスクを継続することができる．

<table>
  <tr>
    <th> <b>Action<b> </th>
    <th> <b>Bypassing<b> </th>
  </tr>
  <tr>
    <td> 紙バッグの選択 </td>
    <td>
      <ul>
        <li> 設置されている2つの紙バッグの中で1つに限定する </li>
        <li> 1つの紙バッグのみが設置される </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> 紙バッグの把持 </td>
    <td>
      <ul>
        <li> ロボットが選択したバッグを，オペレータがロボットに持たせる </li>
        <li> その際，ロボットがオペレーターに紙バッグの位置を伝える </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> マーカを用いた人追従走行 </td>
    <td>
      <ul>
        <li> マーカをオペレータに持たせた状態または取り付けた状態で人追従走行を行う </li>
      </ul> 
    </td>
  </tr>
  <!--
   <tr>
    <td> 未知環境のマッピング </td>
    <td>
      <ul>
        <li> 事前にマッピングしてはいけない屋外の範囲にマッピングを行う
 </li>
        <li> この場合，マッピングが影響する自律移動の得点は半分とする（スコアシート中の「☆」の箇所）
 </li>
      </ul> 
    </td>
  </tr>
  -->
</table>


## スコアシート（Score Sheet）

<table>
  <tr>
    <th> <b>Action</b> </th>
    <th> <b>Score</b> </th>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク</b> </td>
  </tr>
  <tr>
    <td> 紙バッグをアリーナの外にあるゴールまで持ち運ぶ <br> 
      <ul>
        <li> オペレータが選択した紙バッグの検出 </li>
        <li> 選択されたバッグの把持 </li>
        <li> オペレーターを追従してアリーナの外に出る </li>
        <li> オペレーターを追従してアリーナの外にあるゴールへ着く </li>
      </ul> 
    </td>
<!--     <td> 250 <br> 
      <ul  style="list-style: none;">
        <li> 50 </li>
        <li> 100 </li>
        <li> 50 </li>
        <li> 50 </li>
      </ul> 
    </td> -->
    <td align="center"> <!-- 250 <br> --> 50 <br> 100 <br> 50 <br> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b> ボーナスタスク </b> </td>
  </tr>
  <tr>
    <td> アリーナへの再入場
      <ul>
        <li> 自律的にアリーナ内に入る </li>
        <li> 自律的に`スタート地点`へ戻る </li>
    </td>
    <td align="center"> <!-- 50 <br> --> 25 <br> 25 </td>
  </tr>
  <tr>
    <td> 静的な人混み（3～4人）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 地面にある小さな物体（積み木など）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 見づらい3Dオブジェクト（椅子やグラスなど）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 開閉式バリア（ガイドポールなど）を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>ペナルティ</b> </td>
  </tr>
  <tr>
    <td> 不参加（無断） </td>
    <td align="center"> -500 </td>
  </tr>
  <tr>
    <td> <b>合計（ボーナスタスクを含む）</b> </td>
    <td align="center"> <b>500</b> </td>
  </tr>
</table>


> [!NOTE]  
> Educationリーグと同じ競技を採用し，ルール内容も同じなのですが，差別化のため異なる採点方式を用いている．

> [!NOTE]  
> 開閉式バリア（ガイドポールなど）は，三角形のものを3本ほど用いる．`Setup Day`から使用可能（予定）．


## 運営(EC)による指示（Instructions from the Executive Committee(EC)）

- 準備
  - 外の道でロボットの行く手を阻む人を3～4人選ぶ．
  - 紙バッグの位置を選び，オペレーターにバッグを割り当てる．
  - ロボットが屋外で直面する障害物を選択する．
  - ゴール（車）の位置を選択する．
  - アリーナの外に出るときは，ロボットに注意する．
- アナウンス（Setup day）
  - ロボットの`スタート地点`の選択し，アナウンスする．
  - どのバッグを使用するかの選択し，アナウンスする．


## レフェリー(TC)の動き（Role of the Referee(TC)）

- 競技開始30分前に集まり，説明を受け，スコアシートを受け取る．
- シナリオに記載のレフェリーとして行動する．
- スコアシートに基づき，競技を採点する．
- 他のTCと採点内容を確認し合う．
- スコアシートを提出する．

> [!NOTE]  
> TCは各チームから数名選出され，他チームの競技において以下を行ってもらう．詳細については，一般規定の[採点方法](./gr_ja.md#採点方法scoring-system)をご確認ください．
