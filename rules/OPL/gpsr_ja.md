<sub>[READMEへ](../../README.md)</sub>

[日本語](./gpsr_ja.md) | [English](./gpsr_en.md)

# General Purpose Service Robot (GPSR)

参考動画：https://youtu.be/p9ki89buY68 <br>
> [!NOTE]  
> この動画は参考動画である．RoboCupのルールによってタスク内容が異なる可能性がある．
> 質問や議論は，GitHubの[Issues](https://github.com/RoboCupAtHomeJP/Rule2023/issues)にて行う．

> [!NOTE]  
> このルールはRoboCup JapanOpen2022 OPLのGPSRに基づき作成されたものである．

## メインゴール

このタスクでは，ロボットがユーザからの様々な要求に対して応じる汎用サービスを想定する．この競技では，予め決められたタスクの流れや命令，行動内容などは存在しない．競技内でユーザが要求するタスクは，大量に用意されたタスク内容の中からTCによってランダムに選択される．これらのコマンドは，複雑さに応じて4つのカテゴリに分類され，このカテゴリの難易度に基づいて得点も変化する．

## フォーカス

複雑な音声対話，予め定義されていない命令の実行，効率的かつスピーディなタスクの実行，既知環境でのマッピングやナビゲーション，タスクプランニング

## セットアップ

- **ロケーション**: タスクの実行場所は事前に公開される．
- **スタートロケーション**: ロボットは，事前に公開されるスタート地点からスタートする．
- **オペレーター**: オペレーターは，ランダムに選択されたタスクを，ロボットに実行するよう命令する．オペレーターは各チームから選出する．
- **ゲスト**: ゲストは，選択されたタスクに応じて，ジェスチャーやロボットとのインタラクションを行う．ゲストの人数は最大で3人である．ゲストは各チームから選出することができる．

## シナリオ

### a. スタートフェーズ

1. **競技時間**: 競技時間は10分間である．
2. **配置**: レフェリーは，チームにロボットをスタート位置へ移動させるよう指示する．
3. **スタート**: レフェリーはスタートの合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ(スタートボタンを押す等)を完了し，エリアを離れる．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められない．
4. **ゴール**: 1つの命令タスクに対して，コマンドフェーズとサービスフェーズを行う．これを3回繰り返す．

### b. コマンドフェーズ

1. **カテゴリの選択**: チームがレフェリーに希望するカテゴリを伝える．選択したカテゴリに応じてレフェリーはタスクの命令をオペレーターに伝える．
   - Category 1: 低難易度命令
   - Category 2: 中難易度命令
   - Category 3: 高難易度命令 or 不足情報/誤情報を含む命令
2. **ロボットへの命令**: オペレータは，選択されたタスクをロボットに命令する．ロボットがオペレータの命令について理解できなかった場合，もう一度発言を繰り返すように要求することができる．

### c. サービスフェーズ

1. 命令の復唱: ロボットは命令受け取ったあと，命令内容を復唱してから行動を開始する．
2. サービス: ロボットは，与えられた命令のタスクを実行する．タスクの終了後は，次の命令のためにオペレータのもとへ戻る．再度ドアオープンしてアリーナに入る必要はない．

## 注意事項

### スキップの禁止

タスクは3 Stepsで構成され，Stepごとに配点が高くなる．現在与えられている（少なくともフェーズ1の）命令を達成しなければ次のStepへ進むことはできない．

### コマンドジェネレータ

カテゴリ1から3の命令は[コマンドジェネレータ](https://github.com/kyordhel/GPSRCmdGen/tree/legacy)を使用して生成する．TCは事前に命令を十分な数生成し，必要に応じてテスト環境に合わせて命令の変数を変更する．タスクで用いられる命令は，この中からランダムに選定される．

## デウス・エクス・マキナ

General rulesで示すデウスエクスマキナを使用した場合，スコアシートに示す通り，タスクの得点が減点される．
タスク実行中にデウス・エクス・マキナを使用した場合，その種類によらず，デウス・エクス・マキナを使用した回数分（上限を10回とする）減点される（人間による把持や配置の代行，代替手段による発話理解などが例として挙げられる）．具体的なデウス・エクス・マキナの具体例については，RoboCup 2022 Rulebookの各タスクを参照すること．

## リスタート

リスタートは段階に応じて以下のように取り扱う．なお，リスタートした場合，ロボットはスタート地点からタスクを再開する．Step 1を完了している場合，リスタート後に直前のタスクを継続してもよい．この場合，コマンドの理解やタスクの実行を繰り返してもよく，一度獲得した得点が減点されることはない．ただしペナルティとして，リスタート直後に獲得した点数は半減される．

- $n(\le 2)$回目のコマンドの理解の途中
  - 次のコマンドを$n$回目のコマンドとして再開する．
- $n$回目のStep 1の途中（目的地点への移動が完了していない，次のStepへ移る準備ができていない）
  - 次のコマンドを$n$回目のコマンドとして再開する
- $n'(\le 3)$回目のStep 1完了後
  - $n'$回目のコマンドを$n'$回目のコマンドとして続きから再開して良い．物体を把持している場合，その取り扱いはチームに委ねる．

## コマンドセット

| タスクの種類 | 命令文例 |
| --- | --- |
| **Carrying** | &bullet; Go to the ` $ROOM`, grasp the `$OBJECT` on the `$PLACE` and place it on the `$PLACE`. <br>&bullet; Go to the `$ROOM`, grasp the `$OBJECT` on the `$PLACE` and give it to `$PERSON`. |
| **Vision** <br>find (obj \| people) | &bullet; Tell me how many `$CATEGORY_OBJ` there are on the `$PLACE`. <br>&bullet; Tell me how many people in the `$ROOM` are `$POSTURE`. |
| **Navigation** <br>follow, guide | &bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and follow (him \| her). <br>&bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and guide `(him\|her)` to the `$ROOM`. |
| **Speech** <br>question, answer | &bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and answer (his \| her) question. <br>&bullet; Go to the `$ROOM`, find `$PERSON` at the `$ROOM` and ask (him \| her) `$QUESTION`. |

## スコアシート

各動作を4つのStepsに分け，1 Stepごとに採点する．カテゴリ難易度に応じて$cat$の変数が変化する（以下表を参照）．

| Action | Score |
| -- | -- |
|**メインタスク** |  |
| 命令を理解する | $3 \times 20$ |
| 1回目の命令タスクを実行する | $(5 \times 4) \times cat$ |
| 2回目の命令タスクを実行する | $(10 \times 4) \times cat$ |
| 3回目の命令タスクを実行する | $(20 \times 4) \times cat$ |
| 全てのコマンドを実行した後アリーナから退出する | $20$ |
| **デウス・エクス・マキナ** |  |
| 代替手段を用いて命令を理解する | $3 \times -6$ |
| $h (\le 10)$ 回の人間の支援により1回目の命令タスクを実行する | $-2h \times cat$ |
| $h$ 回の人間の支援により2回目の命令タスクを実行する | $-4h \times cat$ |
| $h$ 回の人間の支援により3回目の命令タスクを実行する | $-8h \times cat$ |
| **ペナルティ** |  |
| リスタート | $直後に獲得した点数  \times -0.5$| 
| 不参加（無断） | $-500$ |
| **合計** | $500$ |

### タスクカテゴリごとのStep一覧

| タスクの種類 | Step 1 | Step 2 | Step 3 | Step 4 |
| --- | --- | --- | --- | --- |
| **Carrying** | 物体の前まで移動する | 物体を把持する | 配置場所 / 人の前まで移動する | 物体を配置する / 渡す |
| **Vision** | 観測する部屋・場所まで移動する | 対象を観測する | オペレーターの前まで移動する | 観測結果を報告する |
| **Navigation** | 人の前まで移動する | 人を追従 / 誘導する | 追従 / 誘導先まで移動する | 追従終了を認識 / 誘導終了を報告する |
| **Speech(ask)** | 人の前まで移動する | 人に質問する | オペレーターの前まで移動する | 質問の答えを報告する |
| **Speech(answer)** | 人の前まで移動する | 人に質問を要求する | 質問に答える | オペレーターの前まで移動する |

### カテゴリごとの加重

| Category | $cat.$ |
| -------- | ------ |
| 0 | $0.7$ |
| 1 | $1$ |
| 2 | $2$ |
| 3 | $3$ |

## 運営(TC)による指示

- 準備
  - ボランティア2名に名前を割り当てる．
  - オペレータに挑戦するコマンドを伝える．
- アナウンス(Setup day)
  - 部屋，ロケーション，人物の名称を公開する．
  - 物体の置かれる可能性がある場所を公開する．
  - オペレータ（人物）から命令を聞く可能性のある場所を公開する．
  - アリーナの入口と出口のドアの場所を公開する．

## レフェリーの動き

General rulesに従って選出されたレフェリーは以下を行う．

- 競技開始30分前に集まり，説明を受けスコアシートとコマンドリストを受け取る．
- シナリオに記載のレフェリーとして行動する．
- 競技を採点する
- 他のレフェリー，TCと採点内容を確認する．
- TCへスコアシートを提出する．
