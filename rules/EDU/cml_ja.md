[日本語](./cml_ja.md) | [English](./cml_en.md)

# Carry My Luggage（CML）

参考動画：https://youtu.be/dzyJ1dHTulc

> **Note**
> 参考動画は完璧ではありません．年によってルールも異なるので，あくまで参考程度にしてください．
> 気になる点や議論したい点などがありましたら，GitHubの[Issues](https://github.com/RoboCupAtHomeJP/Rule2023/issues)にご送信ください．

## メインゴール

このタスクでは，外に駐車された車（イメージ）までロボットがオペレータの荷物運搬を支援することを想定している．ロボットは荷物（紙バッグ）を掴んだ後，既知環境から未知環境までオペレータ追従し，荷物運搬の支援を行う．その後，自律的にスタート地点（既知環境）まで戻ることを行う．

## フォーカス

このタスクは，指差し認識，マニピュレーション，既知環境と未知環境でのマッピングやナビゲーション，人追従走行，音声対話，タスクプランニングなどに焦点を当てている．

## セットアップ

- **ロケーション**：家庭環境を模したアリーナ環境が用いられる．競技はアリーナの内外で行われる．`アリーナ内`は事前にマッピングすることができる（`既知環境`）.


- **スタートロケーション**： ロボットは，2つの椅子の中心に向かって，`Dining Room`の中心からスタートする．
- **荷物（紙バッグ）**： オペレーターの近く（2\[m\]以内の距離でロボットから見える位置）に，2つの紙バッグを設置する．
  <!-- - [荷物(バッグ)](https://www.amazon.co.jp/gp/product/B07T52SRRN/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1)には，200×240×90[mm]のものを使用する．-->
  - **サイズ**：未定
  - **配置場所**：OCとTCで行う．この際，荷物（紙バッグ）は椅子の上に設置してい
- **オペレーター**： オペレーターは，ロボットの前に立って競技で使用する紙バッグを指さす．オペレーターは自チーム（任意で人に任せられる）から選出してください．

> **Warning**
> ルールが変わる可能性がある．その際，全体で共有する．

## シナリオ

### スタートフェーズ

1. **競技時間**：競技時間は**7分間**となる．
1. **配置**：レフェリーは，チームにロボットをスタート位置へ移動させるよう指示する．
1. **スタート**：レフェリーはスタートの合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ（スタートボタンを押す等）を完了し，エリアを離れる．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施はしない．
1. **指差し**：オペレータはスタートの合図と同時に，2つの紙バッグの内，事前に指定されたバッグの方を指さす．
1. **把持**：ロボットは，オペレータが指さしたバッグを認識し，それを把持する．

### フォロミーフェーズ

1. **運搬開始**：ロボットが紙バッグを把持し追従可能な状態になったら，ロボットはオペレーターにその主旨を伝える．
1. **歩行**：その後，オペレータは既知環境から未知環境に向かって歩き始める．このとき，アリーナの外にあるゴール地点は固定の場所とする．
1. **フォロミー**：ロボットは歩き始めたオペレータを追従し，走行する．オペレータがゴールにたどり着いた場合，オペレータからその主旨を伝えてもらう．

> **Warning**
> オペレーターが歩行し始めたら、ロボットの方に向いたり，歩行を止まったりすることは禁止とする．

### ナビゲーションフェーズ

1. **受け渡し**：オペレータとロボットがゴールに着いた後，オペレーターはロボットからバッグを受け取り，ロボットにお礼をする．
1. **ナビゲーション**：ロボットは未知環境から既知環境にある`スタート地点`まで自律的に移動する．このとき，ロボットは様々な障害物を回避しながら自律走行を行う．ただし，この障害物に挑戦するかどうかは各チームで決めることができる（障害物を回避するごとに加点される）．
この障害物の種類には下記の4つのモノがある．
   - 人混み（2人）が静的な状態で邪魔をする
   - 地面にある小さな物体（積み木など）
   - 見づらい3Dオブジェクト（椅子やグラスなど）
   - 開閉式バリア（ガイドポールなど）
1. **ゴール**：ロボットが`スタート地点`へ戻ったら，タスク終了になる．

## ローカルルール

1. 競技時間は 7 分間
1. レフェリーの人数は3名で，競技を実施し終わったチームから1名ずつ出す
1. ボーナスタスク
    - 開閉式バリア（ガイドポール）の足は踏んだ場合は，得点は認められない
1. "スタート地点"の範囲は，スタート位置に貼っている印から半径50cm以内である
（範囲内に少しでも入れば有効とする）
1. "アリーナへの再入場"は，ロボット全体がアリーナに入れば有効とする
1. バッグの向きを縦に置くことはしない
1. かばんの把持、障害物の回避のスキップを認める

## メインゴール

| アクション | スコア |
| --- | ---:|
| 正しいバッグを拾う（skip rule） | 100 |
| 人を車までフォローする | 300 |
| 地面にある小さなオブジェクトを避ける（skip rule） | 50 |
| 見えにくいオブジェクトを避ける（skip rule） | 50 |
| 引き込み式のバリアで塞がれたエリアを避ける（skip rule） | 50 |

## ボーナス得点

| アクション | スコア |
| --- | ---:|
| アリーナへの再入場 | 100 |

## 通常のペナルティ

| アクション | スコア |
| --- | ---:|
| バッグを落とす | 50 |

## デウス・エクス・マキナのペナルティ

| アクション | スコア |
| --- | ---:|
| 自然なやりとりによるオペレーターの再発見 | 50 |
| 不自然なやりとりによるオペレーターの再発見 | 100 |
| 直接接触によるオペレーターの再発見 | 200 |

## 特別なペナルティ＆ボーナス

| アクション | スコア |
| --- | ---:|
| 不参加 | 500 |
| 代替の開始信号の使用 | 100 |

合計スコア: **700点**


## 運営(EC)による指示

- 準備
  - 外の道でロボットの行く手を阻む人を競技を行うチームから2人選ぶ．
  - 紙バッグの位置を選び，オペレーターにバッグを割り当てる．
  - ロボットが屋外で直面する障害物を選択する．
  - ゴール（車）の位置を選択する．
  - アリーナの外に出るときは，ロボットに注意する．
- アナウンス（Setup day）
  - ロボットの`スタート地点`の選択し，アナウンスする．
  - どのバッグを使用するかの選択し，アナウンスする．


## レフェリー(TC)の動き

- 競技が終わった各チームの中から1人ずつに集まり，説明を受け，スコアシートを受け取る．
- シナリオに記載のレフェリーとして行動する．
- スコアシートに基づき，競技を採点する．
- 他のTCと採点内容を確認し合う．
- スコアシートを提出する．
