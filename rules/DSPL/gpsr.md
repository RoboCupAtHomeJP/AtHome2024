**現在ルール策定中ですので，今後変更となる可能性があります．**

**GPSRは，コマンドカテゴリ関連やコマンドジェネレータ関連で大きくルールのアップデートが見込まれます．ここに載っているルールはあくまで去年のルールとしてお考え下さい．**

# General Purpose Service Robot (GPSR) for DSPL
- 参考動画：https://youtu.be/Hmcg-QO8Nso
- ※ 参考動画は完璧ではない．年によってルールが異なるため，参考程度にすること．
- ※ 詳細なルールや配点については検討中である．


## メインゴール
オペレータから出される3つのコマンドを達成すること．

## フォーカス
ロボットはオペレータから要求された任意のコマンドを実行するよう求められる．

## セットアップ
- ロケーション： WRS2020 Tidy Upアリーナを基にした，家庭環境を模した環境が用いられる．アリーナ内は事前にマッピングすることができる（既知の環境）．
  - スタートロケーション： ロボットは，アリーナの外からスタートする．
  - インストラクションポイント：ロボットは，事前に定義されるアリーナ内のある地点で，オペレータから命令を受ける．
- オペレータ：ランダムに選択されたタスクを，ロボットに実行するよう命令する．オペレータは観客やレフェリーから選ばれる


## シナリオ
- 競技時間：競技時間は10分間である．
- 命令の使用言語は英語である．

### a. スタートフェーズ
- 配置：レフェリーはチームにロボットをスタート位置へ移動させるよう指示する．
- スタート：レフェリーはスタートの合図を出し，タイマーをスタートさせる．同時にチームは最後の簡単なセットアップ(スタートボタンを押す等)を完了し，エリアを離れる．この際，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められない．また，これ以後チームがロボットに触れると即座に失格になる．
- ドアオープン：チームの1人はスタートの合図と同時にドアを開ける．ロボットはドアが開いたことを認識し，自律的にアリーナへ入場してインストラクションポイントまで移動する．
- ゴール：1つの命令タスクに対して，コマンドフェーズとサービスフェーズを行う．これを3回繰り返す．


### b. コマンドフェーズ
- タスクの選択：チームがレフェリーに希望するカテゴリを伝える．レフェリーはコマンドセットかコマンドジェネレータよりランダムにカテゴリ内のタスクを選択する．
  - Category 0：コマンドセットタスク（後述するコマンドセットを使用）
  - Category 1：低難易度タスク（コマンドジェネレータを使用）
  - Category 2：中難易度タスク（コマンドジェネレータを使用）
  - Category 3：高難易度タスク（不足情報/誤情報を含む）（コマンドジェネレータを使用）
- ロボットへの命令：オペレータは，ここで選択されたタスクをロボットに命令する．このとき，ロボットがオペレータの命令について理解できなかった場合，もう一度発言を繰り返すように要求することができる．もし，受け取った命令で不足する情報があればロボットからオペレータに聞くこともできる．


### c. サービスフェーズ
- 命令の復唱：ロボットは命令を受け取ったあと，命令内容を復唱してから行動を開始する．
- サービス：ロボットは，与えられた命令のタスクを実行します．タスクの終了後は，次の命令のためにインストラクションポイントへ戻る．

## 注意
- ※ 「命令を理解できた」のみの点数を取ることを禁止とする．
  - 「命令を理解できた」の得点を得るためには，「コマンドカテゴリxを成功」に対し何点かの得点があったことが条件である．
  - 得点を1点も取らずに，コマンドをスキップして次のコマンドを求めることは認める（コマンドのスキップ，最大3回まで）
- ※ コマンドの配点が上がる条件について
  - コマンドの配点が上がる条件として，全段のコマンドを「成功」していることを条件とする．「成功」とは，満点を得られている状態である．
- ※ コマンドジェネレータの事前公開
  - RoboCup@HomeのGitHubに公開されているコマンドジェネレータを使用する． ただしカテゴリやオブジェクト，場所名等は変更される．


## デウスエクスマキナ
本タスクでは，次のデウスエクスマキナが採用される．デウスエクスマキナでは該当アクションの点数は入らないが，より簡単な手法でアクションをスキップし，タスクを継続することができる．

| Action | Bypassing |
| --- | --- |
| コマンドの理解 |✓カスタムオペレータの使用<br>　✓「命令を理解できた」の点数が5点になる<br>✓ARマーカ/QRコードの使用<br>　✓点数は入らないが，タスクの継続が可能 |
| コマンドセットの使用 | チームはコマンドジェネレータの代わりにコマンドセットの命令を要求することができる． |
| タスクの支援 | ロボットがタスクを実施出来ない場合，発話など人間にとって自然な形で支援を要求することができる．このとき，レフェリーはロボットの要求が理解できる場合にロボットを支援する．この際，各回の「コマンドを達成」の点数を上限としてレフェリーが減点する場合がある． |

## コマンドセット
コマンドセットの使用を選択した場合，命令の選択のためにコマンドジェネレータは使用されず，代わりに本テーブルのコマンドセットから1つが選択され，使用される．

| タスクの種類 | 命令文 |
| --- | --- |
| bring |✓Go to the ＄{部屋名}, grasp the ＄{物体名} on the ＄{場所名} and place it on the ＄{場所名}.<br>✓Go to the ＄{部屋名}, grasp the ＄{物体名} on the ＄{場所名} and give it to ＄{人物名}. |
| vision<br>(find obj \| people) | ✓Tell me how many ＄{物体カテゴリー名} there are on the ＄{場所名}.<br>✓Tell me how many people in the ＄{部屋名} are ＄{ポーズ}. |
| navigation<br>(follow, guide) | ✓Go to the ＄{部屋名}, find ＄{人物名} at the ＄{場所名} and follow (him \| her).<br>✓Go to the ＄{部屋名}, find ＄{人物名} at the ＄{場所名} and guide (him \| her) to the ＄{場所名}. |
| navigation<br>(follow, guide) | ✓Go to the ＄{部屋名}, find ＄{人物名} at the ＄{場所名} and answer (his \| her) question. <br> ✓Go to the ＄{部屋名}, find ＄{人物名} at the ＄{場所名} and ask (him \| her) ＄{質問}. |

## 準備
- 準備日
  - 部屋，ロケーション，人物の名称を公開．
  - 物体の置かれる可能性がある場所を公開．
- アナウンス(競技2時間前)
  - アリーナの入口と出口のドアの場所，インストラクションポイントを公開．


## スコアシート
| Action | Score |
| --- | --- |
| 命令を理解できた | 10点×3回 |
| 命令を理解できた（カスタムオペレータ） | 5点×3回 |
| 1回目のコマンド | 　 |
| コマンドカテゴリ0を成功 | 5点 |
| コマンドカテゴリ1を成功 | 10点 |
| コマンドカテゴリ2を成功 | 20点 |
| コマンドカテゴリ3を成功 | 30点 |
| コマンドカテゴリ4を成功 | 40点 |
| 2回目のコマンド | 　 |
| コマンドカテゴリ0を成功 | 10点 |
| コマンドカテゴリ1を成功 | 20点 |
| コマンドカテゴリ2を成功 | 40点 |
| コマンドカテゴリ3を成功 | 60点 |
| コマンドカテゴリ4を成功 | 80点 |
| 3回目のコマンド | 　 |
| コマンドカテゴリ0を成功 | 20点 |
| コマンドカテゴリ1を成功 | 40点 |
| コマンドカテゴリ2を成功 | 80点 |
| コマンドカテゴリ3を成功 | 120点 |
| コマンドカテゴリ4を成功 | 160点 |

- ※各コマンドは，次のパーセンテージで部分点を付ける
  - 1ヵ所以上適切な場所へ自律移動する 25%
  - 1人以上の適切な人物／1つ以上の適切な物体へ何かしらアプローチする 25%
